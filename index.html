<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Interactive Guide to Power Query</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: "Modern Tech" (Neutrals: bg-slate-100, text-slate-800; Primary: blue-600; Accent: teal-500) -->
    <!-- Application Structure Plan: A responsive layout with a fixed sidebar navigation and a main content area. This structure provides persistent navigation, allowing users to easily jump between complex topics without losing context. The content is broken into thematic sections with interactive cards and live demos to facilitate focused, hands-on learning. This is superior to a simple tab view for a detailed educational tool. -->
    <!-- Visualization & Content Choices: 1. Transformations Demo: Interactive table with a live M-code viewer. Goal: Connect UI actions to code. 2. Join Types: Visual HTML/CSS diagram with interactive buttons. Goal: Clarify complex concepts visually. 3. Charts: Used for summarizing results in use cases. Goal: Inform & Summarize. 4. M-Code: Presented in styled code blocks with clear explanations. Goal: Educate on advanced topics. All choices avoid SVG/Mermaid and prioritize clarity and interactivity. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .nav-link { transition: all 0.2s ease-in-out; }
        .nav-link.active { background-color: #2563eb; color: white; }
        .nav-link:not(.active):hover { background-color: #e2e8f0; }
        .content-section { display: none; animation: fadeIn 0.6s; }
        .content-section.active { display: block; }
        .code-block { background-color: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-family: 'SF Mono', 'Courier New', monospace; font-size: 0.9em; line-height: 1.6; }
        .code-block .comment { color: #64748b; }
        .code-block .function { color: #34d399; }
        .code-block .string { color: #f59e0b; }
        .code-block .keyword { color: #ec4899; }
        .chart-container { position: relative; width: 100%; max-width: 550px; margin-left: auto; margin-right: auto; height: 320px; max-height: 350px; }
        .interactive-card { transition: transform 0.2s, box-shadow 0.2s; }
        .interactive-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .join-diagram .table { border: 2px solid; border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; font-weight: 600; transition: all 0.3s ease; }
        .join-diagram .overlap { position: absolute; }
        .join-diagram .table-a { border-color: #3b82f6; background-color: #bfdbfe; color: #1e3a8a; }
        .join-diagram .table-b { border-color: #14b8a6; background-color: #ccfbf1; color: #042f2e; }
        .join-diagram .result-area { transition: opacity 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="w-64 bg-white p-6 border-r border-slate-200 fixed h-full transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-30">
            <h2 class="text-2xl font-bold text-slate-900 mb-8">Power Query Guide</h2>
            <nav>
                <ul class="space-y-2">
                    <li><a href="#intro" class="nav-link active flex items-center p-3 rounded-lg font-medium">Introduction</a></li>
                    <li><a href="#getting-started" class="nav-link flex items-center p-3 rounded-lg font-medium">Getting Started</a></li>
                    <li><a href="#intermediate" class="nav-link flex items-center p-3 rounded-lg font-medium">Intermediate Concepts</a></li>
                    <li><a href="#advanced" class="nav-link flex items-center p-3 rounded-lg font-medium">Advanced & M Language</a></li>
                    <li><a href="#use-cases" class="nav-link flex items-center p-3 rounded-lg font-medium">Practical Use Cases</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Mobile Header -->
        <header class="md:hidden fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-sm z-20 border-b border-slate-200">
            <div class="flex items-center justify-between p-4">
                <h1 class="text-lg font-bold text-slate-900">Power Query Guide</h1>
                <button id="menu-toggle" class="p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 md:ml-64 p-6 pt-24 md:pt-10 md:p-10">
            <header class="mb-10">
                <h1 id="main-title" class="text-4xl font-bold text-slate-900">Welcome to the Guide</h1>
                <p id="main-subtitle" class="text-lg text-slate-600 mt-1">Select a topic to begin your journey.</p>
            </header>

            <!-- Introduction Section -->
            <section id="intro" class="content-section active">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-3xl font-bold mb-4 text-slate-900">What is Power Query?</h2>
                    <p class="mb-6 text-lg leading-relaxed"><strong>Power Query</strong> is a data transformation engine and a core component of Microsoft's business intelligence suite. It provides a powerful, visual interface to connect to data sources, perform complex cleaning and shaping operations, and load the results for analysis. Think of it as your personal data assistant, automating the tedious 80% of work that is data preparation, so you can focus on the valuable 20% that is analysis and insight.</p>
                    <div class="grid md:grid-cols-3 gap-6 text-center mb-8">
                        <div class="p-6 bg-slate-50 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-xl text-blue-600 mb-2">1. Extract</h3>
                            <p>Connect to hundreds of sourcesâ€”from a simple Excel file on your desktop to a complex Salesforce database in the cloud.</p>
                        </div>
                        <div class="p-6 bg-slate-50 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-xl text-teal-600 mb-2">2. Transform</h3>
                            <p>Visually clean, reshape, and combine data. Every click records a repeatable step, ensuring consistency and saving time.</p>
                        </div>
                        <div class="p-6 bg-slate-50 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-xl text-indigo-600 mb-2">3. Load</h3>
                            <p>Load the perfected data into Excel or Power BI, creating a reliable foundation for your reports and dashboards.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Getting Started Section -->
            <section id="getting-started" class="content-section">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-3xl font-bold mb-2 text-slate-900">Live Transformation Demo</h2>
                    <p class="mb-6 text-lg">This interactive demo simulates the Power Query editor. Click a transformation button to manipulate the table. Notice how the M Code below the table updates with each step, showing you exactly what Power Query writes behind the scenes.</p>
                    <div class="grid lg:grid-cols-5 gap-8">
                        <div class="lg:col-span-2">
                            <h3 class="text-xl font-semibold mb-3">Transformation Steps</h3>
                            <div class="flex flex-col space-y-2">
                                <button id="reset-btn" class="w-full text-left p-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition font-semibold">Reset Data</button>
                                <button class="transform-btn interactive-card w-full text-left p-3 bg-slate-100 rounded-md" data-transform="remove-column">1. Remove a Column</button>
                                <button class="transform-btn interactive-card w-full text-left p-3 bg-slate-100 rounded-md" data-transform="filter-rows">2. Filter Rows</button>
                                <button class="transform-btn interactive-card w-full text-left p-3 bg-slate-100 rounded-md" data-transform="add-column">3. Add Conditional Column</button>
                                <button class="transform-btn interactive-card w-full text-left p-3 bg-slate-100 rounded-md" data-transform="group-by">4. Group and Aggregate</button>
                            </div>
                        </div>
                        <div class="lg:col-span-3">
                            <h3 id="table-title" class="text-xl font-semibold mb-3">Data Preview</h3>
                            <div class="overflow-x-auto border border-slate-200 rounded-lg mb-4">
                                <table id="demo-table" class="w-full text-sm text-left text-slate-600">
                                    <thead id="demo-table-head" class="text-xs text-slate-700 uppercase bg-slate-50"></thead>
                                    <tbody id="demo-table-body"></tbody>
                                </table>
                            </div>
                            <h3 class="text-xl font-semibold mb-3">Applied Step M Code</h3>
                            <div id="m-code-viewer" class="code-block">
                                <span class="comment">// Click a transform button to see the M Code here...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Intermediate Section -->
            <section id="intermediate" class="content-section">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-3xl font-bold mb-2 text-slate-900">Visualizing Merge Joins</h2>
                    <p class="mb-6 text-lg">Merging (or joining) tables is a fundamental concept. Power Query offers several "Join Kinds" to control how tables are combined. Select a join type below to see a visual representation of how it works and what rows are returned.</p>
                    <div class="flex flex-wrap justify-center gap-2 mb-8">
                        <button class="join-btn p-2 px-4 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold" data-join="inner">Inner</button>
                        <button class="join-btn p-2 px-4 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold" data-join="left">Left Outer</button>
                        <button class="join-btn p-2 px-4 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold" data-join="full">Full Outer</button>
                        <button class="join-btn p-2 px-4 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold" data-join="left-anti">Left Anti</button>
                    </div>
                    <div class="join-diagram relative h-48 flex justify-center items-center">
                        <div class="table table-a overlap" style="left: calc(50% - 60px);">Table A</div>
                        <div class="table table-b overlap" style="left: calc(50% - 20px);">Table B</div>
                        <div id="join-result-left" class="result-area table table-a overlap opacity-0" style="left: calc(50% - 60px); background-color: #93c5fd;"></div>
                        <div id="join-result-right" class="result-area table table-b overlap opacity-0" style="left: calc(50% - 20px); background-color: #5eead4;"></div>
                        <div id="join-result-center" class="result-area absolute w-10 h-20 bg-teal-300 opacity-0" style="left: calc(50% - 20px); border-radius: 0 100% 100% 0 / 0 50% 50% 0;"></div>
                    </div>
                    <p id="join-explanation" class="text-center mt-4 text-slate-600 font-medium h-10"></p>
                </div>
            </section>

            <!-- Advanced Section -->
            <section id="advanced" class="content-section">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-3xl font-bold mb-2 text-slate-900">Advanced & M Language</h2>
                    <p class="mb-6 text-lg">Dive deeper into the Power Query M language to unlock custom logic, create reusable functions, and optimize performance for massive datasets.</p>
                    <div class="space-y-4">
                        <div class="interactive-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                            <h3 class="font-semibold text-xl mb-2">Creating Custom Functions</h3>
                            <p class="mb-4">Encapsulate repeatable logic into your own functions. This example creates a function to standardize text by trimming whitespace and converting it to proper case, while safely handling null values.</p>
                            <div class="code-block">
                                <pre><code>(<span class="keyword">inputText</span> as nullable text) as nullable text =>
let
    Result = <span class="keyword">if</span> inputText <> <span class="keyword">null</span> then
                <span class="function">Text.Proper</span>(<span class="function">Text.Trim</span>(inputText))
             <span class="keyword">else</span>
                <span class="keyword">null</span>
in
    Result</code></pre>
                            </div>
                        </div>
                        <div class="interactive-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                            <h3 class="font-semibold text-xl mb-2">Performance & Query Folding</h3>
                            <p class="mb-2"><strong>Query Folding</strong> is the secret to high performance. It's the process of translating your transformation steps (like filtering) into the native language of your data source (e.g., SQL). This means the source database does the heavy lifting before sending the data to you.</p>
                            <p><strong>Tip:</strong> Steps like filtering, sorting, and removing columns at the beginning of your query are likely to fold. Custom M code often stops folding.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Use Cases Section -->
            <section id="use-cases" class="content-section">
                 <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-3xl font-bold mb-2 text-slate-900">Practical Use Cases</h2>
                    <p class="mb-6 text-lg">Let's apply these concepts to real-world scenarios to see the power of an automated workflow.</p>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="interactive-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                             <h3 class="font-semibold text-xl mb-2">1. Sales Reporting Automation</h3>
                            <p class="mb-4">This workflow combines multiple monthly sales CSVs from a folder, merges them with an Excel-based product lookup table, and groups the data to calculate total sales per category.</p>
                            <div class="chart-container">
                                <canvas id="sales-report-chart"></canvas>
                            </div>
                        </div>
                        <div class="interactive-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                             <h3 class="font-semibold text-xl mb-2">2. Unpivoting Survey Data</h3>
                            <p class="mb-4">Survey data often comes in a "wide" format (one column per question). Unpivoting transforms it into a "tall" format, making it easy to analyze responses across all questions.</p>
                             <div class="chart-container">
                                <canvas id="survey-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const mainTitle = document.getElementById('main-title');
            const mainSubtitle = document.getElementById('main-subtitle');

            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            const sectionTitles = {
                'intro': 'Introduction to Power Query',
                'getting-started': 'Getting Started: The Basics',
                'intermediate': 'Intermediate Concepts',
                'advanced': 'Advanced & M Language',
                'use-cases': 'Practical Use Cases'
            };

            function switchContent(hash) {
                hash = hash || '#intro';
                navLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === hash);
                });
                contentSections.forEach(section => {
                    section.classList.toggle('active', `#${section.id}` === hash);
                });
                mainTitle.textContent = sectionTitles[hash.substring(1)];
                mainSubtitle.textContent = document.querySelector(`.nav-link[href="${hash}"]`).textContent;
                
                if (window.innerWidth < 768) {
                    sidebar.classList.add('-translate-x-full');
                }
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = e.currentTarget.getAttribute('href');
                    history.pushState(null, '', targetId);
                    switchContent(targetId);
                });
            });
            
            window.addEventListener('popstate', () => switchContent(window.location.hash));
            switchContent(window.location.hash);

            // Getting Started Demo
            const initialData = [
                { Product: 'Apple', Category: 'Fruit', Price: 1.2, Stock: 150, Region: 'West' },
                { Product: 'Banana', Category: 'Fruit', Price: 0.5, Stock: 200, Region: 'South' },
                { Product: 'Carrot', Category: 'Vegetable', Price: 0.8, Stock: 300, Region: 'West' },
                { Product: 'Broccoli', Category: 'Vegetable', Price: 1.5, Stock: 120, Region: 'East' },
            ];
            let currentData = JSON.parse(JSON.stringify(initialData));
            const tableHead = document.getElementById('demo-table-head');
            const tableBody = document.getElementById('demo-table-body');
            const tableTitle = document.getElementById('table-title');
            const mCodeViewer = document.getElementById('m-code-viewer');

            function renderTable(data, title) {
                tableTitle.textContent = title;
                tableHead.innerHTML = '';
                tableBody.innerHTML = '';
                if (data.length === 0) return;

                const headers = Object.keys(data[0]);
                const headerRow = document.createElement('tr');
                headers.forEach(header => {
                    const th = document.createElement('th');
                    th.className = 'p-3 font-semibold';
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                tableHead.appendChild(headerRow);

                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.className = 'border-b last:border-b-0 border-slate-200';
                    headers.forEach(header => {
                        const td = document.createElement('td');
                        td.className = 'p-3';
                        td.textContent = row[header];
                        tr.appendChild(td);
                    });
                    tableBody.appendChild(tr);
                });
            }
            
            function updateMCode(code) {
                mCodeViewer.innerHTML = `<pre><code>${code}</code></pre>`;
            }

            document.getElementById('reset-btn').addEventListener('click', () => {
                currentData = JSON.parse(JSON.stringify(initialData));
                renderTable(currentData, 'Original Data');
                updateMCode(`<span class="comment">// Data reset to its original state.</span>`);
            });

            document.querySelectorAll('.transform-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const transformType = e.target.getAttribute('data-transform');
                    let title = '';
                    let mCode = '';
                    switch (transformType) {
                        case 'remove-column':
                            title = "Removed 'Region' Column";
                            currentData = currentData.map(({ Region, ...rest }) => rest);
                            mCode = `<span class="function">Table.RemoveColumns</span>(PreviousStep, {<span class="string">"Region"</span>})`;
                            break;
                        case 'filter-rows':
                            title = "Filtered for Category = 'Fruit'";
                            currentData = currentData.filter(row => row.Category === 'Fruit');
                            mCode = `<span class="function">Table.SelectRows</span>(PreviousStep, <span class="keyword">each</span> [Category] = <span class="string">"Fruit"</span>)`;
                            break;
                        case 'add-column':
                            title = "Added 'Stock Level' Column";
                            currentData.forEach(row => {
                                row['Stock Level'] = row.Stock > 150 ? 'High' : 'Low';
                            });
                            mCode = `<span class="function">Table.AddColumn</span>(PreviousStep, <span class="string">"Stock Level"</span>, <span class="keyword">each if</span> [Stock] > 150 <span class="keyword">then</span> <span class="string">"High"</span> <span class="keyword">else</span> <span class="string">"Low"</span>)`;
                            break;
                        case 'group-by':
                            title = "Grouped by Category";
                            const grouped = currentData.reduce((acc, row) => {
                                acc[row.Category] = (acc[row.Category] || 0) + row.Stock;
                                return acc;
                            }, {});
                            currentData = Object.keys(grouped).map(key => ({ Category: key, TotalStock: grouped[key] }));
                            mCode = `<span class="function">Table.Group</span>(PreviousStep, {<span class="string">"Category"</span>}, {{<span class="string">"TotalStock"</span>, <span class="keyword">each</span> <span class="function">List.Sum</span>([Stock]), <span class="keyword">type number</span>}})`
                            break;
                    }
                    renderTable(currentData, title);
                    updateMCode(mCode);
                });
            });

            renderTable(currentData, 'Data Preview');

            // Join Diagram Logic
            const joinButtons = document.querySelectorAll('.join-btn');
            const joinExplanation = document.getElementById('join-explanation');
            const resultLeft = document.getElementById('join-result-left');
            const resultCenter = document.getElementById('join-result-center');
            const resultRight = document.getElementById('join-result-right');
            const joinExplanations = {
                'inner': 'Returns only the matching rows from both tables.',
                'left': 'Returns all rows from Table A and the matching rows from Table B.',
                'full': 'Returns all rows from both tables, whether they match or not.',
                'left-anti': 'Returns rows from Table A that have no match in Table B.'
            };
            
            joinButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const joinType = button.dataset.join;
                    joinExplanation.textContent = joinExplanations[joinType];
                    
                    resultLeft.style.opacity = (joinType === 'left' || joinType === 'full' || joinType === 'left-anti') ? '0.5' : '0';
                    resultCenter.style.opacity = (joinType === 'inner' || joinType === 'left' || joinType === 'full') ? '0.5' : '0';
                    resultRight.style.opacity = (joinType === 'full') ? '0.5' : '0';
                });
            });
            joinButtons[0].click(); // Activate first button

            // Chart.js instances
            new Chart(document.getElementById('sales-report-chart'), {
                type: 'bar',
                data: {
                    labels: ['Electronics', 'Clothing', 'Groceries', 'Books'],
                    datasets: [{
                        label: 'Total Sales',
                        data: [12000, 9500, 15000, 6000],
                        backgroundColor: '#3b82f6',
                        borderRadius: 4,
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            new Chart(document.getElementById('survey-chart'), {
                type: 'pie',
                data: {
                    labels: ['Very Satisfied', 'Satisfied', 'Neutral', 'Unsatisfied'],
                    datasets: [{
                        data: [450, 800, 300, 150],
                        backgroundColor: ['#14b8a6', '#5eead4', '#a7f3d0', '#fde68a'],
                        borderColor: '#ffffff',
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
            });
        });
    </script>
</body>
</html>
